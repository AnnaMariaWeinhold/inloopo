var F=Object.defineProperty,O=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var D=(n,t,e)=>t in n?F(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,b=(n,t)=>{for(var e in t||(t={}))A.call(t,e)&&D(n,e,t[e]);if(S)for(var e of S(t))k.call(t,e)&&D(n,e,t[e]);return n},E=(n,t)=>O(n,L(t));var y=(n,t,e)=>(D(n,typeof t!="symbol"?t+"":t,e),e);function sliceDataFrom(n,t){return n.slice(n.findIndex(e=>e[0].endsWith(t)))}class Drawdown{constructor(t,e){y(this,"high");y(this,"low");this.high=t,this.low=e}getDrawdownInPercent(){if(this.high.value&&this.low.value)return this.low.value/this.high.value-1}}class Point{constructor(t,e){y(this,"date");y(this,"value");this.date=t,this.value=e}setPoint(t,e){this.date=t,this.value=e}}function calculateDrawdowns(){let n=new Point("",Number.NEGATIVE_INFINITY),t=new Point("",Number.POSITIVE_INFINITY),e=[];return{write(o,a){n.value<a?t.value!==Number.POSITIVE_INFINITY?(e.push(new Drawdown(n,t)),n=new Point(o,a),t=new Point("",Number.POSITIVE_INFINITY)):n.setPoint(o,a):t.value>a&&t.setPoint(o,a)},get(){return e}}}function calculateStrategy(n,t=1e4,e="1998"){basis=sliceDataFrom(n,e);const o=[];let a=t;const s=calculateDrawdowns();for(const[d,l,w]of basis)if(w==="X"){const r=a*(1+l/100);s.write(d,r),o.push(r),a=r}else o.push(a);return{strategyData:o.map(d=>d.toFixed(0)),drawdowns:s.get()}}function calculateSP(n,t=1e4,e="1998"){const o=sliceDataFrom(n,e),a=[];let s=t;const d=calculateDrawdowns();for(const[l,w]of o){const r=s*(1+w/100);a.push(r),s=r,d.write(l,r)}return{spData:a.map(l=>l.toFixed(0)),drawdowns:d.get()}}function debounce(n=500,t){let e;return o=>{e&&clearTimeout(e),e=setTimeout(()=>t(o),n)}}function displayHtmlDrawdowns(n,t){const e=document.getElementById("sp-drawdown-element"),o=document.getElementById("strategy-drawdown-element");e.innerText=`${(Math.min(...n.map(a=>a.getDrawdownInPercent()))*100).toFixed(1)} %`,o.innerText=`${(Math.min(...t.map(a=>a.getDrawdownInPercent()))*100).toFixed(1)} %`}window.addEventListener("DOMContentLoaded",async function(){const n=echarts.init(document.getElementById("interactive-chart")),t=await fetch("/data/20221119-data.json").then(i=>i.json()),e=t.shift(),o=t.map(i=>i[0]),a="inloopo S&P 500 Strategie",s="Buy-And-Hold S&P 500",{spData:d,drawdowns:l}=calculateSP(t),{strategyData:w,drawdowns:r}=calculateStrategy(t);displayHtmlDrawdowns(l,r);const g={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:[a,s]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:o},yAxis:{type:"value"},series:[{name:a,type:"line",smooth:!0,lineStyle:{color:"#ff6b35"},itemStyle:{color:"#ff6b35"},data:w},{name:s,type:"line",smooth:!0,data:d}]};n.setOption(g);const x=document.getElementById("chart-dialog"),P=document.querySelector("#chart-dialog button"),h=document.getElementById("start-money");h.addEventListener("change",i=>{const u=Number(i.target.value),{spData:N,drawdowns:m}=calculateSP(t,u||void 0,c.value||void 0),{strategyData:p,drawdowns:f}=calculateStrategy(t,u||void 0,c.value||void 0);displayHtmlDrawdowns(l,f);const I=E(b({},g),{xAxis:{type:"category",data:sliceDataFrom(t,c.value).map(v=>v[0])},series:[{name:a,type:"line",smooth:!0,lineStyle:{color:"#ff6b35"},itemStyle:{color:"#ff6b35"},data:p},{name:s,type:"line",smooth:!0,data:N}]});n.setOption(I)});const T=document.getElementById("year-picker"),c=document.getElementById("start-year");T.addEventListener("click",function(i){c.value=i.target.dataset.value,c.dispatchEvent(new Event("change"))}),c.addEventListener("change",debounce(600,i=>{c.blur();const u=i.target.value;if(t.findIndex(m=>m[0].endsWith(u))>-1){const{spData:m,drawdowns:p}=calculateSP(t,Number(h.value)||void 0,u),{strategyData:f,drawdowns:I}=calculateStrategy(t,Number(h.value)||void 0,u);displayHtmlDrawdowns(p,I);const v=E(b({},g),{xAxis:{type:"category",data:sliceDataFrom(t,u).map(B=>B[0])},series:[{name:a,type:"line",smooth:!0,lineStyle:{color:"#ff6b35"},itemStyle:{color:"#ff6b35"},data:f},{name:s,type:"line",smooth:!0,data:m}]});n.setOption(v)}else x.style.display="block",P.addEventListener("click",m=>{x.style.display="none"})}))});
