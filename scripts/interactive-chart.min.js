var T=Object.defineProperty,F=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var D=(e,t,n)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,b=(e,t)=>{for(var n in t||(t={}))O.call(t,n)&&D(e,n,t[n]);if(N)for(var n of N(t))A.call(t,n)&&D(e,n,t[n]);return e},E=(e,t)=>F(e,B(t));var y=(e,t,n)=>(D(e,typeof t!="symbol"?t+"":t,n),n);const dynamicChartElement=document.getElementsByTagName("dynamic-chart"),shadow=dynamicChartElement[0].shadowRoot;function sliceDataFrom(e,t){return e.slice(e.findIndex(n=>n[0].endsWith(t)))}class Drawdown{constructor(t,n){y(this,"high");y(this,"low");this.high=t,this.low=n}getDrawdownInPercent(){if(this.high.value&&this.low.value)return this.low.value/this.high.value-1}}class Point{constructor(t,n){y(this,"date");y(this,"value");this.date=t,this.value=n}setPoint(t,n){this.date=t,this.value=n}}function calculateDrawdowns(){let e=new Point("",Number.NEGATIVE_INFINITY),t=new Point("",Number.POSITIVE_INFINITY),n=[];return{write(o,a){e.value<a?t.value!==Number.POSITIVE_INFINITY?(n.push(new Drawdown(e,t)),e=new Point(o,a),t=new Point("",Number.POSITIVE_INFINITY)):e.setPoint(o,a):t.value>a&&t.setPoint(o,a)},get(){return n}}}function calculateStrategy(e,t=1e4,n="1998"){const o=sliceDataFrom(e,n),a=[];let s=t;const d=calculateDrawdowns();for(const[r,m,c]of o)if(c==="X"){const l=s*(1+m/100);d.write(r,l),a.push(l),s=l}else a.push(s);return{strategyData:a.map(r=>r.toFixed(0)),drawdowns:d.get()}}function calculateSP(e,t=1e4,n="1998"){const o=sliceDataFrom(e,n),a=[];let s=t;const d=calculateDrawdowns();for(const[r,m]of o){const c=s*(1+m/100);a.push(c),s=c,d.write(r,c)}return{spData:a.map(r=>r.toFixed(0)),drawdowns:d.get()}}function debounce(e=500,t){let n;return o=>{n&&clearTimeout(n),n=setTimeout(()=>t(o),e)}}function displayHtmlDrawdowns(e,t){const n=shadow.getElementById("sp-drawdown-element"),o=shadow.getElementById("strategy-drawdown-element");n.innerText=`${(Math.min(...e.map(a=>a.getDrawdownInPercent()))*100).toFixed(1)} %`,o.innerText=`${(Math.min(...t.map(a=>a.getDrawdownInPercent()))*100).toFixed(1)} %`}(async function(){await import("/scripts/echarts.js");const e=await fetch("/data/20221119-data.json").then(i=>i.json()),t=echarts.init(shadow.getElementById("interactive-chart")),n=e.shift(),o=e.map(i=>i[0]),a="inloopo S&P 500 Strategie",s="Buy-And-Hold S&P 500",{spData:d,drawdowns:r}=calculateSP(e),{strategyData:m,drawdowns:c}=calculateStrategy(e);displayHtmlDrawdowns(r,c);const l={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:[a,s]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:o},yAxis:{type:"value"},series:[{name:a,type:"line",smooth:!0,lineStyle:{color:"#ff6b35"},itemStyle:{color:"#ff6b35"},data:m},{name:s,type:"line",smooth:!0,data:d}]};t.setOption(l);const p=shadow.getElementById("start-money");p.addEventListener("change",i=>{const w=Number(i.target.value),{spData:x,drawdowns:h}=calculateSP(e,w||void 0,u.value||void 0),{strategyData:g,drawdowns:f}=calculateStrategy(e,w||void 0,u.value||void 0);displayHtmlDrawdowns(r,f);const I=E(b({},l),{xAxis:{type:"category",data:sliceDataFrom(e,u.value).map(v=>v[0])},series:[{name:a,type:"line",smooth:!0,lineStyle:{color:"#ff6b35"},itemStyle:{color:"#ff6b35"},data:g},{name:s,type:"line",smooth:!0,data:x}]});t.setOption(I)});const P=shadow.getElementById("year-picker"),u=shadow.getElementById("start-year");P.addEventListener("click",function(i){u.value=i.target.dataset.value,u.dispatchEvent(new Event("change"))}),u.addEventListener("change",debounce(600,i=>{u.blur();const w=i.path[0].value;if(e.findIndex(h=>h[0].endsWith(w))>-1){const{spData:h,drawdowns:g}=calculateSP(e,Number(p.value)||void 0,w),{strategyData:f,drawdowns:I}=calculateStrategy(e,Number(p.value)||void 0,w);displayHtmlDrawdowns(g,I);const v=E(b({},l),{xAxis:{type:"category",data:sliceDataFrom(e,w).map(S=>S[0])},series:[{name:a,type:"line",smooth:!0,lineStyle:{color:"#ff6b35"},itemStyle:{color:"#ff6b35"},data:f},{name:s,type:"line",smooth:!0,data:h}]});t.setOption(v)}}))})();
