var O=Object.defineProperty,F=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var b=(t,e,n)=>e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,E=(t,e)=>{for(var n in e||(e={}))A.call(e,n)&&b(t,n,e[n]);if(S)for(var n of S(e))M.call(e,n)&&b(t,n,e[n]);return t},D=(t,e)=>F(t,L(e));var h=(t,e,n)=>(b(t,typeof e!="symbol"?e+"":e,n),n);function sliceDataFrom(t,e){return t.slice(t.findIndex(n=>n[0].endsWith(e)))}class Drawdown{constructor(e,n){h(this,"high");h(this,"low");this.high=e,this.low=n}getDrawdownInPercent(){if(this.high.value&&this.low.value)return this.low.value/this.high.value-1}}class Point{constructor(e,n){h(this,"date");h(this,"value");this.date=e,this.value=n}setPoint(e,n){this.date=e,this.value=n}}function calculateDrawdowns(){let t=new Point("",Number.NEGATIVE_INFINITY),e=new Point("",Number.POSITIVE_INFINITY),n=[];return{write(o,a){t.value<a?e.value!==Number.POSITIVE_INFINITY?(n.push(new Drawdown(t,e)),t=new Point(o,a),e=new Point("",Number.POSITIVE_INFINITY)):t.setPoint(o,a):e.value>a&&e.setPoint(o,a)},get(){return n}}}function calculateStrategy(t,e=1e4,n="1998"){basis=sliceDataFrom(t,n);const o=[];let a=e;const s=calculateDrawdowns();for(const[d,c,w]of basis)if(w==="X"){const r=a*(1+c/100);s.write(d,r),o.push(r),a=r}else o.push(a);return{strategyData:o.map(d=>d.toFixed(0)),drawdowns:s.get()}}function calculateSP(t,e=1e4,n="1998"){const o=sliceDataFrom(t,n),a=[];let s=e;const d=calculateDrawdowns();for(const[c,w]of o){const r=s*(1+w/100);a.push(r),s=r,d.write(c,r)}return{spData:a.map(c=>c.toFixed(0)),drawdowns:d.get()}}function debounce(t=500,e){let n;return o=>{n&&clearTimeout(n),n=setTimeout(()=>e(o),t)}}function displayHtmlDrawdowns(t,e){const n=document.getElementById("sp-drawdown-element"),o=document.getElementById("strategy-drawdown-element");n.innerText=`${(Math.min(...t.map(a=>a.getDrawdownInPercent()))*100).toFixed(1)} %`,o.innerText=`${(Math.min(...e.map(a=>a.getDrawdownInPercent()))*100).toFixed(1)} %`}const chartSection=document.getElementById("interactive-chart-section");window.addEventListener("DOMContentLoaded",function(){const t=new IntersectionObserver(e=>{e.forEach(n=>{typeof window.echarts!="undefined"&&t.disconnect(),n.isIntersecting&&chartSection.dispatchEvent(new Event("load-interactive-chart"))})},{root:null,rootMargin:"0px",threshold:.1});t.observe(chartSection)}),chartSection.addEventListener("load-interactive-chart",async function(){await import("/scripts/echarts.js");const t=await fetch("/data/20221119-data.json").then(i=>i.json()),e=echarts.init(document.getElementById("interactive-chart")),n=t.shift(),o=t.map(i=>i[0]),a="inloopo S&P 500 Strategie",s="Buy-And-Hold S&P 500",{spData:d,drawdowns:c}=calculateSP(t),{strategyData:w,drawdowns:r}=calculateStrategy(t);displayHtmlDrawdowns(c,r);const y={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:[a,s]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:o},yAxis:{type:"value"},series:[{name:a,type:"line",smooth:!0,lineStyle:{color:"#ff6b35"},itemStyle:{color:"#ff6b35"},data:w},{name:s,type:"line",smooth:!0,data:d}]};e.setOption(y);const x=document.getElementById("chart-dialog"),P=document.querySelector("#chart-dialog button"),p=document.getElementById("start-money");p.addEventListener("change",i=>{const u=Number(i.target.value),{spData:N,drawdowns:m}=calculateSP(t,u||void 0,l.value||void 0),{strategyData:g,drawdowns:f}=calculateStrategy(t,u||void 0,l.value||void 0);displayHtmlDrawdowns(c,f);const v=D(E({},y),{xAxis:{type:"category",data:sliceDataFrom(t,l.value).map(I=>I[0])},series:[{name:a,type:"line",smooth:!0,lineStyle:{color:"#ff6b35"},itemStyle:{color:"#ff6b35"},data:g},{name:s,type:"line",smooth:!0,data:N}]});e.setOption(v)});const T=document.getElementById("year-picker"),l=document.getElementById("start-year");T.addEventListener("click",function(i){l.value=i.target.dataset.value,l.dispatchEvent(new Event("change"))}),l.addEventListener("change",debounce(600,i=>{l.blur();const u=i.target.value;if(t.findIndex(m=>m[0].endsWith(u))>-1){const{spData:m,drawdowns:g}=calculateSP(t,Number(p.value)||void 0,u),{strategyData:f,drawdowns:v}=calculateStrategy(t,Number(p.value)||void 0,u);displayHtmlDrawdowns(g,v);const I=D(E({},y),{xAxis:{type:"category",data:sliceDataFrom(t,u).map(B=>B[0])},series:[{name:a,type:"line",smooth:!0,lineStyle:{color:"#ff6b35"},itemStyle:{color:"#ff6b35"},data:f},{name:s,type:"line",smooth:!0,data:m}]});e.setOption(I)}else x.style.display="block",P.addEventListener("click",m=>{x.style.display="none"})}))});
